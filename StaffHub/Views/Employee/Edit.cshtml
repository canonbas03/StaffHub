@model StaffHub.Models.ViewModels.EmployeeCreateVM

<h1>Edit @Model.FirstName @Model.LastName</h1>

<form asp-action="Edit" method="post">
    <input type="hidden" asp-for="EmployeeId" />
    <div class="form-group">
        <label asp-for="FirstName">First Name:</label>
        <input asp-for="FirstName" class="form-control" />
        <span asp-validation-for="FirstName" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="LastName">Last Name:</label>
        <input asp-for="LastName" class="form-control" />
        <span asp-validation-for="LastName" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Salary">Salary:</label>
        <input asp-for="Salary" class="form-control" />
        <span asp-validation-for="Salary" class="text-danger"></span>
    </div>
    <div class="form-group">
        <h1>Department</h1>
        @*   <select id="DepartmentId" name="DepartmentId" class="form-control">
            <option value="">@(Model.Role?.Department?.Name)</option>
            @foreach (var dept in ViewBag.Departments)
            {
                if (dept.Name == Model.Role?.Department?.Name)
                {
                    <option value="@dept.DepartmentId">@dept.Name *</option>
                }
                else
                {
                    <option value="@dept.DepartmentId">@dept.Name</option>
                }
            }
        </select> *@
        <label>Departmentbby</label>
        <select id="DepartmentId" asp-items="@(new SelectList(ViewBag.Departments, "DepartmentId", "Name", Model.RoleId))" class="form-control">
        </select>
    </div>
    <div>
        <label asp-for="RoleId">Role</label>
        <select id="RoleId" name="RoleId" class="form-control"></select>
    </div>
    <div class="form-group">
        <label asp-for="Email">Email</label>
        <input asp-for="Email" class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Password">Password (leave empty to keep current)</label>
        <input asp-for="Password" class="form-control" type="password" />
        <span asp-validation-for="Password" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="PermissionRole">Permission Role</label>
        <select asp-for="PermissionRole" class="form-control" asp-items="@(new SelectList(Model.AvailableRoles,Model.PermissionRole))">
            <option value="">--Select--</option>
        </select>
    </div>

    <button type="submit">Edit</button>
    <button asp-action="List">Back</button>
</form>

<script>
    function loadRoles(){
        var deptId = document.getElementById("DepartmentId").value;
        fetch(`/Employee/GetRolesByDepartment/${deptId}`)
        .then(response => response.json())
        .then(data => {
            var roleDropdown = document.getElementById("RoleId");
            roleDropdown.innerHTML = `<option value="">--Select--</option>`;
            data.forEach(r => {
                var option = document.createElement("option");
                option.value = r.roleId;
                option.text = r.name;
                roleDropdown.appendChild(option);
            });
         if(data.some(r => r.roleId == @Model.RoleId)){
            roleDropdown.value = '@Model.RoleId';
            }
        else{
             roleDropdown.selectedIndex=0;
            }
        });
    }
    document.getElementById("DepartmentId").addEventListener("change",loadRoles);
    document.addEventListener("DOMContentLoaded",loadRoles);
</script>